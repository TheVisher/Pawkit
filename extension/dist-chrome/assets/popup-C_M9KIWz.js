import{c as v,r as n,j as e,a as M,b as fe,d as a,L as I,C as J,e as Q,B as x,f as Y,E as Z,g as ge,h as pe,i as we,R as ve}from"./index-DZeXwrQw.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=v("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=v("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=v("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=v("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=v("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=v("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=v("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),L=n.forwardRef(({className:c,type:d,...i},l)=>e.jsx("input",{type:d,className:M("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),ref:l,...i}));L.displayName="Input";const te=n.forwardRef(({className:c,...d},i)=>e.jsx("textarea",{className:M("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),ref:i,...d}));te.displayName="Textarea";const Se=fe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),w=n.forwardRef(({className:c,...d},i)=>e.jsx("label",{ref:i,className:M(Se(),c),...d}));w.displayName="Label";function Ie(c){try{const d=new URL(c);if(!d.hostname.includes("tiktok.com"))return!1;const i=["/foryou","/following","/explore","/live"],l=d.pathname.toLowerCase();return i.some(b=>l===b||l.startsWith(b+"?")||l.startsWith(b+"/"))||l==="/"||l===""?!0:l.includes("/video/")?!1:!!l.match(/^\/@[\w.-]+\/?$/)}catch{return!1}}function Le(){const[c,d]=n.useState(""),[i,l]=n.useState(""),[b,O]=n.useState(""),[T,ae]=n.useState(""),[p,U]=n.useState(!1),[ne,A]=n.useState(!1),[z,h]=n.useState(""),[re,ie]=n.useState(null),[V,k]=n.useState(!1),[E,R]=n.useState(null),[le,K]=n.useState(!0),[q,H]=n.useState(""),[D,j]=n.useState(""),[F,G]=n.useState(!1),[P,N]=n.useState(null),[oe,_]=n.useState([]),[y,ce]=n.useState(null),[W,C]=n.useState(!1);n.useEffect(()=>{(async()=>{var r;try{const[s]=await a.tabs.query({active:!0,currentWindow:!0});if(s){let g=s.title||"",S=s.url||"";if(s.url&&s.id&&Ie(s.url))try{const m=await a.tabs.sendMessage(s.id,{type:"GET_TIKTOK_VIDEO_URL"});m!=null&&m.url&&(S=m.url,m.title&&(g=m.title))}catch(m){console.warn("Failed to get TikTok video URL:",m)}if(d(g),l(S),S){const m=new URL(S).hostname;ae(`https://www.google.com/s2/favicons?domain=${m}&sz=32`)}}K(!0);const u=await a.runtime.sendMessage({type:"CHECK_AUTH"}),f=u.ok===!0;if(k(f),(r=u.user)!=null&&r.email&&R(u.user.email),f){C(!0);try{const g=await a.runtime.sendMessage({type:"GET_COLLECTIONS"});g.ok&&g.data&&_(g.data)}catch(g){console.error("Failed to fetch collections:",g)}finally{C(!1)}}const X=await a.storage.local.get("selectedImage");X.selectedImage&&(N(X.selectedImage),await a.storage.local.remove("selectedImage"))}catch(s){console.error("Failed to initialize popup:",s)}finally{K(!1)}})();const o=r=>{var s;(s=r.selectedImage)!=null&&s.newValue&&(N(r.selectedImage.newValue),a.storage.local.remove("selectedImage")),r.pawkit_session&&a.runtime.sendMessage({type:"CHECK_AUTH"}).then(u=>{var f;k(u.ok===!0),(f=u.user)!=null&&f.email&&R(u.user.email)})};return a.storage.onChanged.addListener(o),()=>{a.storage.onChanged.removeListener(o)}},[]);const de=async()=>{try{await a.runtime.sendMessage({type:"INITIATE_LOGIN"}),window.close()}catch(t){console.error("Failed to initiate login:",t),h("Failed to open login page")}},ue=async()=>{try{await a.runtime.sendMessage({type:"LOGOUT"}),k(!1),R(null),_([])}catch(t){console.error("Failed to logout:",t)}},me=async()=>{try{h("");const[t]=await a.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){h("Cannot access current tab");return}await a.tabs.sendMessage(t.id,{type:"START_IMAGE_PICKER"}),window.close()}catch(t){console.error("Failed to start image picker:",t),h("Cannot pick image on this page (browser internal pages are not supported)")}},he=async()=>{var t,o;if(!c.trim()||!i.trim()){h("Title and URL are required");return}if(!V){h("Please log in first");return}U(!0),h(""),A(!1);try{const r={type:"SAVE_CARD",payload:{title:c.trim(),url:i.trim(),notes:b.trim()||void 0,tags:y?[y]:void 0,source:"webext",meta:{favicon:T,ogImage:P||void 0}}},s=await a.runtime.sendMessage(r);s.ok?(A(!0),ie(((o=(t=s.data)==null?void 0:t.card)==null?void 0:o.id)||null),O(""),N(null)):h(s.error||"Failed to save card")}catch(r){h(r instanceof Error?r.message:"Failed to save card")}finally{U(!1)}},$=()=>{a.runtime.openOptionsPage()},xe=async()=>{const t=y?`/pawkits/${y}`:"/library",o=`https://getpawkit.com${t}`,s=(await a.tabs.query({})).find(u=>{var f;return(f=u.url)==null?void 0:f.includes("getpawkit.com")});s!=null&&s.id?((s.url?new URL(s.url).pathname:"")===t?await a.tabs.update(s.id,{active:!0}):await a.tabs.update(s.id,{active:!0,url:o}),s.windowId&&await a.windows.update(s.windowId,{focused:!0})):await a.tabs.create({url:o})};if(le)return e.jsx("div",{className:"w-96 h-32 flex items-center justify-center",children:e.jsx(I,{className:"h-6 w-6 animate-spin text-muted-foreground"})});const B=async()=>{const t=q.trim();if(!t){j("Please enter your extension token");return}if(!t.startsWith("pawkit_ext_")){j('Invalid token format. Token should start with "pawkit_ext_"');return}G(!0),j("");try{const o=await a.runtime.sendMessage({type:"VALIDATE_TOKEN",token:t});if(o.ok){k(!0),H(""),C(!0);const r=await a.runtime.sendMessage({type:"GET_COLLECTIONS"});r.ok&&r.data&&_(r.data),C(!1)}else j(o.error||"Invalid token")}catch{j("Failed to validate token")}finally{G(!1)}};return V?e.jsx("div",{className:"w-96 max-h-[600px] overflow-y-auto",children:e.jsxs(J,{className:"border-0 rounded-none shadow-none",children:[e.jsx(Q,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[T&&e.jsx("img",{src:T,alt:"",className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[240px]",children:i?new URL(i).hostname:""})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[E&&e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[100px]",title:E,children:E}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ue,title:"Log out",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:$,title:"Settings",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})}),e.jsxs(Y,{className:"space-y-2 pt-0 pb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{htmlFor:"title",className:"text-xs",children:"Title"}),e.jsx(L,{id:"title",value:c,onChange:t=>d(t.target.value),placeholder:"Page title",disabled:p,className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{htmlFor:"url",className:"text-xs",children:"URL"}),e.jsx(L,{id:"url",value:i,onChange:t=>l(t.target.value),placeholder:"https://...",disabled:p,className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{htmlFor:"collection",className:"text-xs",children:"Save to"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:y?e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("select",{id:"collection",value:y||"",onChange:t=>ce(t.target.value||null),disabled:p||W,className:"w-full h-8 pl-9 pr-8 rounded-md border border-input bg-background text-sm appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Library"}),oe.map(t=>e.jsx("option",{value:t.slug,children:t.name},t.id))]}),e.jsx(be,{className:"absolute right-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),W&&e.jsx(I,{className:"absolute right-8 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Thumbnail"}),P?e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-muted/50 rounded-md border border-border",children:[e.jsx("img",{src:P,alt:"Selected thumbnail",className:"w-10 h-10 object-cover rounded border border-border flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground flex-1 min-w-0 truncate",children:"Selected"}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>N(null),children:e.jsx(Ce,{className:"h-3 w-3"})})]}):e.jsxs(x,{variant:"outline",size:"sm",onClick:me,disabled:p,className:"w-full h-8",children:[e.jsx(je,{className:"mr-2 h-3 w-3"}),"Select from Page"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{htmlFor:"notes",className:"text-xs",children:"Notes (optional)"}),e.jsx(te,{id:"notes",value:b,onChange:t=>O(t.target.value),placeholder:"Add your notes...",className:"min-h-[44px] resize-none text-sm",disabled:p})]}),z&&e.jsx("div",{className:"text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded p-2",children:z}),ne&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400 bg-green-400/10 border border-green-400/20 rounded p-2",children:[e.jsx(pe,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"Saved!"}),re&&e.jsxs(x,{variant:"link",size:"sm",className:"ml-auto h-auto p-0 text-green-400",onClick:xe,children:["View ",e.jsx(Z,{className:"ml-1 h-3 w-3"})]})]}),e.jsx(x,{onClick:he,disabled:p,className:"w-full bg-gradient-to-r from-[#6d5cff] to-[#a36bff] hover:from-[#5d4cef] hover:to-[#9358ef]",children:p?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save to Pawkit"})]})]})}):e.jsx("div",{className:"w-96",children:e.jsxs(J,{className:"border-0 rounded-none shadow-none",children:[e.jsx(Q,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:a.runtime.getURL("icons/icon-48.png"),alt:"Pawkit",className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Pawkit Web Clipper"})]}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:$,title:"Settings",children:e.jsx(ee,{className:"h-4 w-4"})})]})}),e.jsxs(Y,{className:"space-y-4 pb-4",children:[e.jsx("div",{className:"text-muted-foreground text-sm text-center",children:"Enter your extension token to start saving pages, articles, and links."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"token",className:"text-xs",children:"Extension Token"}),e.jsx(L,{id:"token",type:"password",value:q,onChange:t=>H(t.target.value),placeholder:"pawkit_ext_...",disabled:F,className:"h-9 font-mono text-sm",onKeyDown:t=>t.key==="Enter"&&B()}),D&&e.jsx("p",{className:"text-xs text-destructive",children:D})]}),e.jsx(x,{onClick:B,disabled:F,className:"w-full bg-gradient-to-r from-[#6d5cff] to-[#a36bff] hover:from-[#5d4cef] hover:to-[#9358ef]",children:F?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Connect Extension"]})}),e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground text-center mb-2",children:"Or connect with one click"}),e.jsxs(x,{variant:"outline",size:"sm",onClick:de,className:"w-full",children:[e.jsx(Z,{className:"mr-2 h-3 w-3"}),"Connect via Pawkit"]})]})]})]})})}const se=document.getElementById("root");if(!se)throw new Error('Root element with id="root" not found in DOM');we.createRoot(se).render(e.jsx(ve.StrictMode,{children:e.jsx(Le,{})}));
