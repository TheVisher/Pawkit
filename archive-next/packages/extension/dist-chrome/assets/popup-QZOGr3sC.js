import{c as x,r as s,j as e,a as C,b as W,d as a,C as X,e as J,B as b,f as Q,L as M,g as Y,E as Z,h as ee,R as te}from"./index-Dvmed-cr.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=x("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=x("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=x("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=x("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=x("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=x("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),k=s.forwardRef(({className:i,type:c,...n},v)=>e.jsx("input",{type:c,className:C("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:v,...n}));k.displayName="Input";const T=s.forwardRef(({className:i,...c},n)=>e.jsx("textarea",{className:C("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:n,...c}));T.displayName="Textarea";const ie=W("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),p=s.forwardRef(({className:i,...c},n)=>e.jsx("label",{ref:n,className:C(ie(),i),...c}));p.displayName="Label";function ce(){const[i,c]=s.useState(""),[n,v]=s.useState(""),[S,I]=s.useState(""),[y,V]=s.useState(""),[u,L]=s.useState(!1),[A,R]=s.useState(!1),[P,d]=s.useState(""),[U,q]=s.useState(null),[j,H]=s.useState(!1),[N,w]=s.useState(null),[O,_]=s.useState([]),[g,D]=s.useState(null),[E,F]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const[r]=await a.tabs.query({active:!0,currentWindow:!0});if(r&&(c(r.title||""),v(r.url||""),r.url)){const m=new URL(r.url).hostname;V(`https://www.google.com/s2/favicons?domain=${m}&sz=32`)}const f=(await a.runtime.sendMessage({type:"CHECK_AUTH"})).ok===!0;if(H(f),f){F(!0);try{const m=await a.runtime.sendMessage({type:"GET_COLLECTIONS"});m.ok&&m.data&&_(m.data)}catch(m){console.error("Failed to fetch collections:",m)}finally{F(!1)}}const h=await a.storage.local.get("selectedImage");h.selectedImage&&(console.log("[Popup] Found selected image in storage:",h.selectedImage),w(h.selectedImage),await a.storage.local.remove("selectedImage"))}catch(r){console.error("Failed to initialize popup:",r)}})();const l=r=>{var o;(o=r.selectedImage)!=null&&o.newValue&&(console.log("[Popup] Image selected via storage:",r.selectedImage.newValue),w(r.selectedImage.newValue),a.storage.local.remove("selectedImage"))};return a.storage.onChanged.addListener(l),()=>{a.storage.onChanged.removeListener(l)}},[]);const B=async()=>{try{d("");const[t]=await a.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){d("Cannot access current tab");return}await a.tabs.sendMessage(t.id,{type:"START_IMAGE_PICKER"}),window.close()}catch(t){console.error("Failed to start image picker:",t),d("Cannot pick image on this page (browser internal pages are not supported)")}},$=async()=>{var t;if(!i.trim()||!n.trim()){d("Title and URL are required");return}if(!j){d("Not logged in. Please log in to Pawkit in your browser.");return}L(!0),d(""),R(!1);try{const l={type:"SAVE_CARD",payload:{title:i.trim(),url:n.trim(),notes:S.trim()||void 0,tags:g?[g]:void 0,source:"webext",meta:{favicon:y,ogImage:N||void 0}}},r=await a.runtime.sendMessage(l);r.ok?(R(!0),q(((t=r.data)==null?void 0:t.id)||null),I(""),w(null)):d(r.error||"Failed to save card")}catch(l){d(l instanceof Error?l.message:"Failed to save card")}finally{L(!1)}},G=()=>{a.runtime.openOptionsPage()},K=async()=>{const t=g?`/pawkits/${g}`:"/library",l=`https://getpawkit.com${t}`,o=(await a.tabs.query({})).find(f=>{var h;return(h=f.url)==null?void 0:h.includes("getpawkit.com")});o!=null&&o.id?((o.url?new URL(o.url).pathname:"")===t?await a.tabs.update(o.id,{active:!0}):await a.tabs.update(o.id,{active:!0,url:l}),o.windowId&&await a.windows.update(o.windowId,{focused:!0})):await a.tabs.create({url:l})};return e.jsx("div",{className:"w-96 max-h-[600px] overflow-y-auto",children:e.jsxs(X,{className:"border-0 rounded-none shadow-none",children:[e.jsxs(J,{className:"pb-2 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y&&e.jsx("img",{src:y,alt:"",className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[280px]",children:n?new URL(n).hostname:""})]}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:G,title:"Settings",children:e.jsx(ne,{className:"h-4 w-4"})})]}),!j&&e.jsx("div",{className:"text-xs text-muted-foreground bg-destructive/10 border border-destructive/20 rounded p-2 mt-2",children:"Not logged in. Please log in to Pawkit in your browser first."})]}),e.jsxs(Q,{className:"space-y-2 pt-0 pb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"title",className:"text-xs",children:"Title"}),e.jsx(k,{id:"title",value:i,onChange:t=>c(t.target.value),placeholder:"Page title",disabled:u,className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"url",className:"text-xs",children:"URL"}),e.jsx(k,{id:"url",value:n,onChange:t=>v(t.target.value),placeholder:"https://...",disabled:u,className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"collection",className:"text-xs",children:"Save to"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:g?e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("select",{id:"collection",value:g||"",onChange:t=>D(t.target.value||null),disabled:u||E,className:"w-full h-8 pl-9 pr-8 rounded-md border border-input bg-background text-sm appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Library"}),O.map(t=>e.jsx("option",{value:t.slug,children:t.name},t.id))]}),e.jsx(ae,{className:"absolute right-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),E&&e.jsx(M,{className:"absolute right-8 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{className:"text-xs",children:"Thumbnail"}),N?e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-muted/50 rounded-md border border-border",children:[e.jsx("img",{src:N,alt:"Selected thumbnail",className:"w-10 h-10 object-cover rounded border border-border flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground flex-1 min-w-0 truncate",children:"Selected"}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>w(null),children:e.jsx(le,{className:"h-3 w-3"})})]}):e.jsxs(b,{variant:"outline",size:"sm",onClick:B,disabled:u,className:"w-full h-8",children:[e.jsx(re,{className:"mr-2 h-3 w-3"}),"Select from Page"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"notes",className:"text-xs",children:"Notes (optional)"}),e.jsx(T,{id:"notes",value:S,onChange:t=>I(t.target.value),placeholder:"Add your notes...",className:"min-h-[44px] resize-none text-sm",disabled:u})]}),P&&e.jsx("div",{className:"text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded p-2",children:P}),A&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400 bg-green-400/10 border border-green-400/20 rounded p-2",children:[e.jsx(Y,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"Saved!"}),U&&e.jsxs(b,{variant:"link",size:"sm",className:"ml-auto h-auto p-0 text-green-400",onClick:K,children:["View ",e.jsx(Z,{className:"ml-1 h-3 w-3"})]})]}),e.jsx(b,{onClick:$,disabled:u||!j,className:"w-full bg-gradient-to-r from-[#6d5cff] to-[#a36bff] hover:from-[#5d4cef] hover:to-[#9358ef]",children:u?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save to Pawkit"})]})]})})}const z=document.getElementById("root");if(!z)throw new Error('Root element with id="root" not found in DOM');ee.createRoot(z).render(e.jsx(te.StrictMode,{children:e.jsx(ce,{})}));
