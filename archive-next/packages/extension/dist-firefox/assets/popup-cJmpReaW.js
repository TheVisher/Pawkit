import{c as w,r,j as e,a as I,b as ne,d as a,L as S,C as _,e as q,B as h,f as D,g as le,h as ie,i as oe,E as ce,k as de,R as ue}from"./index-ecxL3Ide.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=w("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=w("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=w("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=w("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=w("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=w("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),L=r.forwardRef(({className:o,type:d,...l},v)=>e.jsx("input",{type:d,className:I("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),ref:v,...l}));L.displayName="Input";const B=r.forwardRef(({className:o,...d},l)=>e.jsx("textarea",{className:I("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),ref:l,...d}));B.displayName="Textarea";const pe=ne("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),p=r.forwardRef(({className:o,...d},l)=>e.jsx("label",{ref:l,className:I(pe(),o),...d}));p.displayName="Label";function we(){const[o,d]=r.useState(""),[l,v]=r.useState(""),[E,R]=r.useState(""),[j,W]=r.useState(""),[g,P]=r.useState(!1),[$,F]=r.useState(!1),[M,c]=r.useState(""),[X,Y]=r.useState(null),[T,N]=r.useState(!1),[y,k]=r.useState(null),[J,z]=r.useState(!0),[C,b]=r.useState(null),[Q,A]=r.useState([]),[f,Z]=r.useState(null),[O,U]=r.useState(!1);r.useEffect(()=>{(async()=>{var n;try{const[s]=await a.tabs.query({active:!0,currentWindow:!0});if(s&&(d(s.title||""),v(s.url||""),s.url)){const x=new URL(s.url).hostname;W(`https://www.google.com/s2/favicons?domain=${x}&sz=32`)}z(!0);const i=await a.runtime.sendMessage({type:"CHECK_AUTH"}),m=i.ok===!0;if(N(m),(n=i.user)!=null&&n.email&&k(i.user.email),m){U(!0);try{const x=await a.runtime.sendMessage({type:"GET_COLLECTIONS"});x.ok&&x.data&&A(x.data)}catch(x){console.error("Failed to fetch collections:",x)}finally{U(!1)}}const V=await a.storage.local.get("selectedImage");V.selectedImage&&(b(V.selectedImage),await a.storage.local.remove("selectedImage"))}catch(s){console.error("Failed to initialize popup:",s)}finally{z(!1)}})();const u=n=>{var s;(s=n.selectedImage)!=null&&s.newValue&&(b(n.selectedImage.newValue),a.storage.local.remove("selectedImage")),n.pawkit_session&&a.runtime.sendMessage({type:"CHECK_AUTH"}).then(i=>{var m;N(i.ok===!0),(m=i.user)!=null&&m.email&&k(i.user.email)})};return a.storage.onChanged.addListener(u),()=>{a.storage.onChanged.removeListener(u)}},[]);const ee=async()=>{try{await a.runtime.sendMessage({type:"INITIATE_LOGIN"}),window.close()}catch(t){console.error("Failed to initiate login:",t),c("Failed to open login page")}},te=async()=>{try{await a.runtime.sendMessage({type:"LOGOUT"}),N(!1),k(null),A([])}catch(t){console.error("Failed to logout:",t)}},se=async()=>{try{c("");const[t]=await a.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){c("Cannot access current tab");return}await a.tabs.sendMessage(t.id,{type:"START_IMAGE_PICKER"}),window.close()}catch(t){console.error("Failed to start image picker:",t),c("Cannot pick image on this page (browser internal pages are not supported)")}},ae=async()=>{var t,u;if(!o.trim()||!l.trim()){c("Title and URL are required");return}if(!T){c("Please log in first");return}P(!0),c(""),F(!1);try{const n={type:"SAVE_CARD",payload:{title:o.trim(),url:l.trim(),notes:E.trim()||void 0,tags:f?[f]:void 0,source:"webext",meta:{favicon:j,ogImage:C||void 0}}},s=await a.runtime.sendMessage(n);s.ok?(F(!0),Y(((u=(t=s.data)==null?void 0:t.card)==null?void 0:u.id)||null),R(""),b(null)):c(s.error||"Failed to save card")}catch(n){c(n instanceof Error?n.message:"Failed to save card")}finally{P(!1)}},H=()=>{a.runtime.openOptionsPage()},re=async()=>{const t=f?`/pawkits/${f}`:"/library",u=`https://getpawkit.com${t}`,s=(await a.tabs.query({})).find(i=>{var m;return(m=i.url)==null?void 0:m.includes("getpawkit.com")});s!=null&&s.id?((s.url?new URL(s.url).pathname:"")===t?await a.tabs.update(s.id,{active:!0}):await a.tabs.update(s.id,{active:!0,url:u}),s.windowId&&await a.windows.update(s.windowId,{focused:!0})):await a.tabs.create({url:u})};return J?e.jsx("div",{className:"w-96 h-32 flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):T?e.jsx("div",{className:"w-96 max-h-[600px] overflow-y-auto",children:e.jsxs(_,{className:"border-0 rounded-none shadow-none",children:[e.jsx(q,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[j&&e.jsx("img",{src:j,alt:"",className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[240px]",children:l?new URL(l).hostname:""})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[y&&e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[100px]",title:y,children:y}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:te,title:"Log out",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:H,title:"Settings",children:e.jsx(G,{className:"h-4 w-4"})})]})]})}),e.jsxs(D,{className:"space-y-2 pt-0 pb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"title",className:"text-xs",children:"Title"}),e.jsx(L,{id:"title",value:o,onChange:t=>d(t.target.value),placeholder:"Page title",disabled:g,className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"url",className:"text-xs",children:"URL"}),e.jsx(L,{id:"url",value:l,onChange:t=>v(t.target.value),placeholder:"https://...",disabled:g,className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"collection",className:"text-xs",children:"Save to"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:f?e.jsx(he,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("select",{id:"collection",value:f||"",onChange:t=>Z(t.target.value||null),disabled:g||O,className:"w-full h-8 pl-9 pr-8 rounded-md border border-input bg-background text-sm appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Library"}),Q.map(t=>e.jsx("option",{value:t.slug,children:t.name},t.id))]}),e.jsx(me,{className:"absolute right-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),O&&e.jsx(S,{className:"absolute right-8 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{className:"text-xs",children:"Thumbnail"}),C?e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-muted/50 rounded-md border border-border",children:[e.jsx("img",{src:C,alt:"Selected thumbnail",className:"w-10 h-10 object-cover rounded border border-border flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground flex-1 min-w-0 truncate",children:"Selected"}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>b(null),children:e.jsx(fe,{className:"h-3 w-3"})})]}):e.jsxs(h,{variant:"outline",size:"sm",onClick:se,disabled:g,className:"w-full h-8",children:[e.jsx(ge,{className:"mr-2 h-3 w-3"}),"Select from Page"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"notes",className:"text-xs",children:"Notes (optional)"}),e.jsx(B,{id:"notes",value:E,onChange:t=>R(t.target.value),placeholder:"Add your notes...",className:"min-h-[44px] resize-none text-sm",disabled:g})]}),M&&e.jsx("div",{className:"text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded p-2",children:M}),$&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400 bg-green-400/10 border border-green-400/20 rounded p-2",children:[e.jsx(oe,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"Saved!"}),X&&e.jsxs(h,{variant:"link",size:"sm",className:"ml-auto h-auto p-0 text-green-400",onClick:re,children:["View ",e.jsx(ce,{className:"ml-1 h-3 w-3"})]})]}),e.jsx(h,{onClick:ae,disabled:g,className:"w-full bg-gradient-to-r from-[#6d5cff] to-[#a36bff] hover:from-[#5d4cef] hover:to-[#9358ef]",children:g?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save to Pawkit"})]})]})}):e.jsx("div",{className:"w-96",children:e.jsxs(_,{className:"border-0 rounded-none shadow-none",children:[e.jsx(q,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:a.runtime.getURL("icons/icon-48.png"),alt:"Pawkit",className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Pawkit Web Clipper"})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:H,title:"Settings",children:e.jsx(G,{className:"h-4 w-4"})})]})}),e.jsxs(D,{className:"space-y-4 pb-4",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-muted-foreground text-sm mb-4",children:"Log in to Pawkit to start saving pages, articles, and links."}),e.jsxs(h,{onClick:ee,className:"w-full bg-gradient-to-r from-[#6d5cff] to-[#a36bff] hover:from-[#5d4cef] hover:to-[#9358ef]",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Log in to Pawkit"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"You'll be redirected to getpawkit.com to log in. Once logged in, return here to save content."})]})]})})}const K=document.getElementById("root");if(!K)throw new Error('Root element with id="root" not found in DOM');de.createRoot(K).render(e.jsx(ue.StrictMode,{children:e.jsx(we,{})}));
